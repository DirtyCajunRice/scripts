#!/bin/bash
#This scripts show my personal servers online or offline status

# Variables
servercluster="hermes zeus" # Available: apollo aphrodite ares poseidon
echo "Cluster Status:"
awk 'BEGIN {printf "%12s %9s %10s\n", "Server Name", "HTTP", "SSH"}'
for server in $servercluster; do
    awk -v server=$server 'BEGIN {printf "%12s", server }'
    typeset -A status
    status=(
    [http]="$(nmap "$server" -Pn -p http | egrep 'open|closed|filtered' | awk 'NR==1{print $2}')"
    [ssh]="$(nmap "$server" -Pn -p ssh | egrep 'open|closed|filtered' | awk '{print $2}')"
    )
    for service in "${!status[@]}"; do
        if [[ "${status[$service]}"  == "open" ]]; then
            awk 'BEGIN {printf "%21s", "[\033[32mOnline\033[0m]"}'
        elif [[ "${status[$service]}" == "closed" ]]; then
            awk 'BEGIN {printf "%21s", "[\033[31mOffline\033[0m]"}'
        elif [[ "${status[$service]}" == "filtered" ]]; then
            awk 'BEGIN {printf "%21s", "[\033[33mTimeout\033[0m]"}'
        else
            awk 'BEGIN {printf "%21s", "[\033[33mTimeout\033[0m]"}'
        fi
    done
    echo
done
echo
